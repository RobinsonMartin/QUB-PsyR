<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.258">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>QUB-PsyR - The two-factorial ANOVA</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    <img src="./images/QUBlogoWsmall.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">QUB-PsyR</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-intro" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Intro</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-intro">    
        <li>
    <a class="dropdown-item" href="./intro1.html">
 <span class="dropdown-text">R and RStudio</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./intro2.html">
 <span class="dropdown-text">Running Code in R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./intro3.html">
 <span class="dropdown-text">Objects and Functions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./intro4.html">
 <span class="dropdown-text">Data Frames and Lists</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./intro5.html">
 <span class="dropdown-text">Saving and Loading Data</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-working-with-r-objects" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Working with R Objects</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-working-with-r-objects">    
        <li>
    <a class="dropdown-item" href="./working1.html">
 <span class="dropdown-text">Binary Operators</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./working2.html">
 <span class="dropdown-text">Functions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./working3.html">
 <span class="dropdown-text">Numerical Indexing</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./working4.html">
 <span class="dropdown-text">Logical Indexing</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./working5.html">
 <span class="dropdown-text">R Packages</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-statistical-inference" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Statistical Inference</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-statistical-inference">    
        <li>
    <a class="dropdown-item" href="./inference0.html">
 <span class="dropdown-text">A Primer on Statistical Inference</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./inference1.html">
 <span class="dropdown-text">The t-test</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./inference2.html">
 <span class="dropdown-text">The Chi²-test</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./inference3.html">
 <span class="dropdown-text">Correlations</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./inference4.html">
 <span class="dropdown-text">One-factorial Analysis of Variance</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./inference5.html">
 <span class="dropdown-text">Two-factorial Analysis of Variance</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="./about.html">
 <span class="menu-text">About</span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">The two-factorial ANOVA</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>The two-factorial analysis of variance (ANOVA) in an extension of the one-factorial ANOVA. It allows us to test how the mean of a continuous variable differs as a function for two categorical variables <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span>. In a two-factorial ANOVA, we can not only test for the independent effects of the two variables on the outcome, but also a possible interaction of the two variables <span class="math inline">\(A \times B\)</span>. Here, interaction means that the magnitude and/or direction of the effect of one of the variables depends on the level of the second variable.</p>
<p>A two-factorial design requires that the two variables <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span> are “crossed”. That means that each level of the first factor <span class="math inline">\(A\)</span> must be combined with each level of the second second factor <span class="math inline">\(B\)</span>. If <span class="math inline">\(A\)</span> has three levels and <span class="math inline">\(B\)</span> has two levels, our design has a total of 6 cells, and we would refer to it as a <span class="math inline">\(3 \times 2\)</span>-design.</p>
<p>If we ensure, in addition, that all cells of our design have the same sample size, we call our design <strong>orthogonal</strong>. Orthogonality is not required for running a two-factorial ANOVA, but it comes with an advantage: equal sample sizes make the ANOVA robust against violating the assumption of equal variances.</p>
<section id="general-logic-of-the-two-factorial-anova" class="level2">
<h2 class="anchored" data-anchor-id="general-logic-of-the-two-factorial-anova">General logic of the two-factorial ANOVA</h2>
<p>Just as with the one-factorial ANOVA, its two-factorial cousin partitions the variance of the outcome variable <span class="math inline">\(\sigma_x^2\)</span> into signal and noise. The signal is the variance that stems from differences between groups, and the noise is the variance that is due to differences within the groups. Here, too, we can simplify the partition of variances by partitioning the sums of squares instead. As with the one-factorial ANOVA, we can state that:</p>
<p><span class="math display">\[SS_{total} = SS_{between} + SS_{within}\]</span></p>
<p>The difference to the one-factorial ANVOA is that we can now partition the signal (the <span class="math inline">\(SS_{between}\)</span>) even further. Specifically, we can partition the variability between groups into variability that is due to the first factor <span class="math inline">\(A\)</span>, variability that is due to the second factor <span class="math inline">\(B\)</span>, and variability that results from the interaction of the two factors <span class="math inline">\(A \times B\)</span>. We can state this formally as follows:</p>
<p><span class="math display">\[SS_{between} = SS_A + SS_B + SS_{A \times B}\]</span></p>
<p>Let’s have a closer look at the sums of squares using a simplest possible example, namely the <span class="math inline">\(2 \times 2\)</span>-design, in which factor <span class="math inline">\(A\)</span> has <span class="math inline">\(J = 2\)</span> levels, and factor <span class="math inline">\(B\)</span> also has <span class="math inline">\(K=2\)</span> levels. We can think of this design as a squares divided into four parts (see below):</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="inference5_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>In each of the four cells of this <span class="math inline">\(2 \times 2\)</span> design, there are <span class="math inline">\(n_{jk}\)</span> many observations of the outcome variable <span class="math inline">\(x\)</span>, where <span class="math inline">\(n_{jk}\)</span> is the sample size in the cell formed by the <span class="math inline">\(j\)</span>th level of <span class="math inline">\(A\)</span> and the <span class="math inline">\(k\)</span>th level of <span class="math inline">\(B\)</span>. We denote individual observations as <span class="math inline">\(x_{ijk}\)</span>, which refers to the <span class="math inline">\(i\)</span>th observation in the cell formed b the <span class="math inline">\(j\)</span>th level of <span class="math inline">\(A\)</span> and the <span class="math inline">\(k\)</span>th level of <span class="math inline">\(B\)</span>.</p>
<p>When we want to partition the sum of squares in a two-factorial design, we first need to compute the total sum of squares. We do so, by collapsing across all cells of our design and summing the squared deviations of all observations from the grand mean <span class="math inline">\(\bar{x}\)</span> (i.e., the mean computed across all observations irrespective of which cell they stem from). We can formalise this as:</p>
<p><span class="math display">\[SS_{total} = \sum_{j=1}^{J} \sum_{k=1}^{K} \sum_{i=1}^{n_{jk}} (x_{ijk}-\bar{x})^2\]</span> The next step is computing <span class="math inline">\(SS_{between}\)</span> by pretending that there is no variance within groups. Computing the <span class="math inline">\(SS_{between}\)</span> works similar to the one-factorial ANOVA. That means, we replace each observation <span class="math inline">\(x_{ijk}\)</span> with the mean of its cell <span class="math inline">\(\bar{x}_{jk}\)</span> before computing the sum of the squared deviations from the grand mean <span class="math inline">\(\bar{x}_{jk}\)</span>.</p>
<p><span class="math display">\[SS_{between} = \sum_{j=1}^{J} \sum_{k=1}^{K} n_{jk} \times (\bar{x}_{jk} - \bar{x})^2\]</span> Computing the <span class="math inline">\(SS_{within}\)</span> is also similar to the one-factorial ANOVA. We pretend that there is no variation between groups by replacing the grand mean <span class="math inline">\(\bar{x}\)</span> with the cell means <span class="math inline">\(\bar{x}_{jk}\)</span> in the formula for the total sum of squares.</p>
<p><span class="math display">\[SS_{within} = \sum_{j=1}^{J} \sum_{k=1}^{K} \sum_{i = 1}^{n_{jk}}  (x_{ijk} - \bar{x}_{jk})\]</span> So far, so good. We have now partitioned <span class="math inline">\(SS_{total}\)</span> into the <span class="math inline">\(SS_{between}\)</span> and the <span class="math inline">\(SS_{within}\)</span>. However, since we have a <span class="math inline">\(2 \times 2\)</span>-design, we are not merely interested in <em>whether</em> there is substantial variation between the groups, but also <em>where</em> this variation originates. Thus, we need to partition the sums of squares further.</p>
<p>We first compute <span class="math inline">\(SS_A\)</span>, that is, the variation that is solely due to differences in factor <span class="math inline">\(A\)</span>. We do so by pretending that a) there is no factor <span class="math inline">\(B\)</span>, and b) there is no variation within cells. The latter is necessary because <span class="math inline">\(SS_A\)</span> is part of <span class="math inline">\(SS_{between}\)</span>. The good thing is that we already know how to do it, namely by replacing individual observations with a mean score. But how do we pretend that there is no factor <span class="math inline">\(B\)</span>? Effectively, we collapse across all levels of <span class="math inline">\(B\)</span> and combine them into one big cell for each level of <span class="math inline">\(A\)</span>. Here is what our <span class="math inline">\(2 \times 2\)</span>-design would look like in our minds now:</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="inference5_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We now denote the individual observations as <span class="math inline">\(x_{ij\cdot}\)</span>. The little dot reminds us that there was originally another factor <span class="math inline">\(B\)</span> across which we have now collapsed the cells of our design. To obtain <span class="math inline">\(SS_A\)</span>, we now need to replace all individual observations with their respective cell means respective cell means <span class="math inline">\(\bar{x}_{j\cdot}\)</span> and then compute the sum of their squared deviations from the grand mean <span class="math inline">\(\bar{x}\)</span> .</p>
<p><span class="math display">\[SS_A = \sum_{j=1}^{J} n_{j\cdot}(\bar{x}_{j\cdot}-\bar{x})^2   \]</span> Here, <span class="math inline">\(n_{j\cdot}\)</span> refers to the number of observations for the <span class="math inline">\(j\)</span>th level of factor <span class="math inline">\(A\)</span> (irrespective of the level of factor <span class="math inline">\(B\)</span>).</p>
<p>We can now compute the <span class="math inline">\(SS_B\)</span> in a similar fashion, namely by pretending that a) there is no factor <span class="math inline">\(A\)</span>, and b) there is no variation within cells. Our imagined design now looks like this:</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="inference5_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We note denote individual observations as <span class="math inline">\(x_{i\cdot k}\)</span> to emphasize that we do not consider which level of <span class="math inline">\(A\)</span> an observation stems from. Accordingly, the cell means are now denoted as <span class="math inline">\(\bar{x}_{\cdot k}\)</span>. The <span class="math inline">\(SS_B\)</span> are formally defined as:</p>
<p><span class="math display">\[SS_B = \sum_{k=1}^{K} n_{\cdot k}(\bar{x}_{\cdot k}-\bar{x})^2   \]</span></p>
<p>Finally, we need to compute the variability that is due to the interaction of <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span>. The simplest way to do so is to subtract the newly computed <span class="math inline">\(SS_A\)</span> and <span class="math inline">\(SS_B\)</span> from <span class="math inline">\(SS_{between}\)</span>:</p>
<p><span class="math inline">\(SS_{A \times B} = SS_{between} - SS_A - SS_B\)</span></p>
<p>If we run a two-factorial ANOVA, we no longer need the <span class="math inline">\(SS_{between}\)</span> because its parts, <span class="math inline">\(SS_A\)</span>, <span class="math inline">\(SS_B\)</span>, and <span class="math inline">\(SS_{a \times B}\)</span> contain all the variation between groups. The next step is to test each component of the between-group variation for statistical significance. The logic is similar to that of the one-factorial ANOVA, that is, we test for significant using an <span class="math inline">\(F\)</span>-statistic.</p>
<p>Since we have three possible sources of between-group variability, we will run three tests: one for the main effect of factor <span class="math inline">\(A\)</span>, one for the main effect of factor <span class="math inline">\(B\)</span>, and one for the interaction effect <span class="math inline">\(a \times B\)</span>. For each of these tests, we need to compute the mean squares of the effect we are interested in and divide it by the <span class="math inline">\(MS_within\)</span>. We can obtain <span class="math inline">\(MS_A\)</span>, <span class="math inline">\(MS_B\)</span>, <span class="math inline">\(MS_{A \times B}\)</span>, and <span class="math inline">\(MS_within\)</span> by dividing the respective sum of squares by its degrees of freedom (see below).</p>
<p><span class="math display">\[MS_A = \frac{SS_A}{J-1}\]</span> <span class="math display">\[MS_B = \frac{SS_B}{K-1}\]</span></p>
<p><span class="math display">\[MS_{A\times B} = \frac{SS_{A\times B}}{(J-1)(K-1)}\]</span> <span class="math display">\[MS_{within} = \frac{SS_{within}}{N-J\times K}\]</span></p>
<section id="the-main-effect-of-factor-a" class="level4">
<h4 class="anchored" data-anchor-id="the-main-effect-of-factor-a">The main effect of factor A</h4>
<p>Let’s first look at the test for the main effect of <span class="math inline">\(A\)</span>. The <span class="math inline">\(F\)</span>-statistic looks as follows:</p>
<p><span class="math display">\[\frac{MS_A}{MS_{wihtin}} \sim F_{J-1;N-J\times K}\]</span> We use it to test the following hypotheses:</p>
<p><span class="math inline">\(H_{0_A}: \alpha_j = 0 \quad \forall j\)</span></p>
<p><span class="math inline">\(H_{1_A}: \lnot H_{0_A}\)</span></p>
<p>Here, <span class="math inline">\(\alpha_j\)</span> is the true effect of the <span class="math inline">\(j\)</span>th level of <span class="math inline">\(A\)</span> such that:</p>
<p><span class="math inline">\(\mu_{j\cdot} = \mu+\alpha_j\)</span></p>
<p>In other words, when we add <span class="math inline">\(\alpha_j\)</span> to the overall population mean <span class="math inline">\(\mu\)</span> (the true value of <span class="math inline">\(\bar{x}\)</span>), we obtain the expectancy of the mean for the <span class="math inline">\(j\)</span>th level of <span class="math inline">\(A\)</span> (collapsed over all levels of <span class="math inline">\(B\)</span>).</p>
</section>
<section id="the-main-effect-of-factor-b" class="level4">
<h4 class="anchored" data-anchor-id="the-main-effect-of-factor-b">The main effect of factor B</h4>
<p>Regarding the main effect of <span class="math inline">\(B\)</span>, this is what the <span class="math inline">\(F\)</span>-statistic look:</p>
<p><span class="math display">\[\frac{MS_B}{MS_{wihtin}} \sim F_{K-1;N-J\times K}\]</span> The corresponding hypotheses are:</p>
<p><span class="math inline">\(H_{0_B}: \beta_k = 0 \quad \forall k\)</span></p>
<p><span class="math inline">\(H_{1_B}: \lnot H_{0_B}\)</span></p>
<p>Here, <span class="math inline">\(\beta_k\)</span> is the true effect of the <span class="math inline">\(k\)</span>th level of B, which is formally defined such that:</p>
<p><span class="math inline">\(\mu_{\cdot k} = \mu + \beta_k\)</span></p>
<p>This means that adding <span class="math inline">\(\beta_k\)</span> to the true population mean <span class="math inline">\(\mu\)</span> will result in the expected mean of the <span class="math inline">\(k\)</span>th level of factor <span class="math inline">\(B\)</span> (collapsed across all levels of <span class="math inline">\(A\)</span>).</p>
</section>
<section id="the-interaction-of-a-and-b" class="level4">
<h4 class="anchored" data-anchor-id="the-interaction-of-a-and-b">The interaction of A and B</h4>
<p>The <span class="math inline">\(F\)</span>-statistic for the interaction effect <span class="math inline">\(A \times B\)</span> is defined as follows:</p>
<p><span class="math display">\[\frac{MS_{A \times B}}{MS_{wihtin}} \sim F_{(J-1)(K-1);N-J\times K}\]</span></p>
<p>We use this <span class="math inline">\(F\)</span>-statistic to test the final hypothesis, which is very similar to the main effect hypotheses:</p>
<p><span class="math inline">\(H_{0_{A \times B}}: \gamma_{A \times = 0 \quad \forall j,k}\)</span></p>
<p><span class="math inline">\(H_{1_B}: \lnot H_{0_{A\times B}}\)</span></p>
<p>Here, <span class="math inline">\(\gamma_{jk}\)</span> is the effect that combining the <span class="math inline">\(j\)</span>th level of <span class="math inline">\(A\)</span> and the <span class="math inline">\(k\)</span>th level of <span class="math inline">\(B\)</span> has on the population mean *beyond** the respective main effects <span class="math inline">\(\alpha_j\)</span> and <span class="math inline">\(\beta_k\)</span>. We define <span class="math inline">\(\gamma_{A \times B}\)</span> such that:</p>
<p><span class="math display">\[\mu_{jk} = \mu + \alpha_j + \beta_k + \gamma_{jk} = 0\]</span></p>
</section>
</section>
<section id="running-a-two-factorial-anova-in-r" class="level2">
<h2 class="anchored" data-anchor-id="running-a-two-factorial-anova-in-r">Running a two-factorial ANOVA in R</h2>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>